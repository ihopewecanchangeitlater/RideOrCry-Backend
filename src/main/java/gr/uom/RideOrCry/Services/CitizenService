package gr.uom.RideOrCry.Services;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import gr.uom.RideOrCry.Model.Citizen;
import gr.uom.RideOrCry.Repositories.CitizenRepository;

@Service
public class CitizenService {

    @Autowired
    private CitizenRepository cr;
    
    public List<Citizen> getAllCitizens() {
        return cr.findAll();
    }
    
    public String citizenLogin(Citizen c) {
        Optional<Citizen> citizenOpt = Optional.ofNullable(cr.findByEmail(c.getEmail()));
        
        if (!citizenOpt.isPresent()) {
            return "Error: User not found.";
        }

        Citizen citizen = citizenOpt.get();
        if (!citizen.getPassword().equals(c.getPassword())) {
            return "Error: Incorrect password.";
        }

        return "Success: Login successful!";
    }

    public String citizenSignUp(Citizen c) {
        Optional<Citizen> existingCitizen = Optional.ofNullable(cr.findByEmail(c.getEmail()));
        if (existingCitizen.isPresent()) {
            return "Error: User already exists.";
        }

        if (!CustomValidation.isValidEmail(c.getEmail())) { 
            return "Error: Invalid email format.";
        }

        if (!CustomValidation.isValidAfm(c.getAfm())) { 
            return "Error: AFM must be exactly 9 digits.";
        }

        if (c.getName() == null || c.getName().isEmpty()) {
            return "Error: Name is required.";
        }

        if (c.getSurname() == null || c.getSurname().isEmpty()) {
            return "Error: Surname is required.";
        }

        if (c.getPassword().length() < 6) {
            return "Error: Password must be at least 6 characters long.";
        }

        cr.save(c);
        return "Success: Welcome!";
    }
}
